echo "create database tops with template seeddb;alter database tops owner to opalroot; grant connect on database tops to opal; grant create on database tops to opal;"| psql -U postgres
echo "ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO opal;GRANT SELECT ON ALL TABLES IN SCHEMA public TO opal;"| psql -U postgres -d tops
echo "truncate table measurement; \copy measurement ( visit_occurrence_id,measurement_id,person_id,measurement_concept_id,measurement_date,measurement_datetime,measurement_type_concept_id,value_as_concept_id,value_as_number,unit_concept_id,unit_source_value ) from 'measurement.csv' with(FORMAT CSV,HEADER, NULL \"NA\")" | psql -U postgres -d tops
echo "truncate table observation; \copy observation ( visit_occurrence_id,observation_id,person_id,observation_concept_id,observation_date,observation_datetime,observation_type_concept_id,value_as_concept_id,value_as_number,value_as_string,value_source_value,qualifier_concept_id,unit_concept_id,unit_source_value ) from 'observation.csv' with(FORMAT CSV,HEADER, NULL \"NA\")" | psql -U postgres -d tops
echo "truncate table observation_period; \copy observation_period ( observation_period_id,person_id,observation_period_start_date,observation_period_end_date,period_type_concept_id ) from 'observation_period.csv' with(FORMAT CSV,HEADER, NULL \"NA\")" | psql -U postgres -d tops
echo "truncate table person; \copy person ( person_id,birth_datetime,day_of_birth,month_of_birth,year_of_birth,gender_concept_id,race_concept_id,ethnicity_concept_id,person_source_value,gender_source_value ) from 'person.csv' with(FORMAT CSV,HEADER, NULL \"NA\")" | psql -U postgres -d tops
echo "truncate table visit_occurrence; \copy visit_occurrence ( visit_occurrence_id,person_id,visit_start_date,visit_end_date,visit_concept_id,visit_type_concept_id,visit_source_value ) from 'visit_occurrence.csv' with(FORMAT CSV,HEADER, NULL \"NA\")" | psql -U postgres -d tops
